-- Re-enable Dalaran trigger quest (for teleport), 12845
DELETE FROM `disables` WHERE `entry` = 12845;

-- DB/Loot: Fix creatures 18129, 18280, 20387 Greater Sporebat, Sporewing, Young Sporebat not having item 24426 Sporebat Eye as quest loot (by imbabaer)
DELETE FROM `creature_loot_template` WHERE `entry` IN (18129, 18280, 20387) AND `item` = 24426;
INSERT INTO `creature_loot_template` (entry, item, ChanceOrQuestChance, lootmode, groupid, mincountOrRef, maxcount) VALUES
(18129, 24426, -0.8, 1, 0, 1, 1),
(18280, 24426, -0.5, 1, 0, 1, 1),
(20387, 24426, -18, 1, 0, 1, 1);

-- DB/Quest: Set quest_template for Quest 11117 Catch the Wild Wolpertinger! to original TrinityCore values. (by imbabaer)
-- DB/NPC: Fix related NPC 23487 Wild Wolpertinger, make it attackable (by imbabaer)
DELETE FROM quest_template WHERE id = 11117;
INSERT INTO quest_template (Id, Method, Level, MinLevel, MaxLevel, ZoneOrSort, Type, SuggestedPlayers, LimitTime, RequiredClasses, RequiredRaces, RequiredSkillId, RequiredSkillPoints, RequiredFactionId1, RequiredFactionId2, RequiredFactionValue1, RequiredFactionValue2, RequiredMinRepFaction, RequiredMaxRepFaction, RequiredMinRepValue, RequiredMaxRepValue, PrevQuestId, NextQuestId, ExclusiveGroup, NextQuestIdChain, RewardXPId, RewardOrRequiredMoney, RewardMoneyMaxLevel, RewardSpell, RewardSpellCast, RewardHonor, RewardHonorMultiplier, RewardMailTemplateId, RewardMailDelay, SourceItemId, SourceItemCount, SourceSpellId, Flags, SpecialFlags, RewardTitleId, RequiredPlayerKills, RewardTalents, RewardArenaPoints, RewardItemId1, RewardItemId2, RewardItemId3, RewardItemId4, RewardItemCount1, RewardItemCount2, RewardItemCount3, RewardItemCount4, RewardChoiceItemId1, RewardChoiceItemId2, RewardChoiceItemId3, RewardChoiceItemId4, RewardChoiceItemId5, RewardChoiceItemId6, RewardChoiceItemCount1, RewardChoiceItemCount2, RewardChoiceItemCount3, RewardChoiceItemCount4, RewardChoiceItemCount5, RewardChoiceItemCount6, RewardFactionId1, RewardFactionId2, RewardFactionId3, RewardFactionId4, RewardFactionId5, RewardFactionValueId1, RewardFactionValueId2, RewardFactionValueId3, RewardFactionValueId4, RewardFactionValueId5, RewardFactionValueIdOverride1, RewardFactionValueIdOverride2, RewardFactionValueIdOverride3, RewardFactionValueIdOverride4, RewardFactionValueIdOverride5, PointMapId, PointX, PointY, PointOption, Title, Objectives, Details, EndText, OfferRewardText, RequestItemsText, CompletedText, RequiredNpcOrGo1, RequiredNpcOrGo2, RequiredNpcOrGo3, RequiredNpcOrGo4, RequiredNpcOrGoCount1, RequiredNpcOrGoCount2, RequiredNpcOrGoCount3, RequiredNpcOrGoCount4, RequiredSourceItemId1, RequiredSourceItemId2, RequiredSourceItemId3, RequiredSourceItemId4, RequiredSourceItemCount1, RequiredSourceItemCount2, RequiredSourceItemCount3, RequiredSourceItemCount4, RequiredItemId1, RequiredItemId2, RequiredItemId3, RequiredItemId4, RequiredItemId5, RequiredItemId6, RequiredItemCount1, RequiredItemCount2, RequiredItemCount3, RequiredItemCount4, RequiredItemCount5, RequiredItemCount6, RequiredSpellCast1, RequiredSpellCast2, RequiredSpellCast3, RequiredSpellCast4, Unknown0, ObjectiveText1, ObjectiveText2, ObjectiveText3, ObjectiveText4, DetailsEmote1, DetailsEmote2, DetailsEmote3, DetailsEmote4, DetailsEmoteDelay1, DetailsEmoteDelay2, DetailsEmoteDelay3, DetailsEmoteDelay4, EmoteOnIncomplete, EmoteOnComplete, OfferRewardEmote1, OfferRewardEmote2, OfferRewardEmote3, OfferRewardEmote4, OfferRewardEmoteDelay1, OfferRewardEmoteDelay2, OfferRewardEmoteDelay3, OfferRewardEmoteDelay4, StartScript, CompleteScript, WDBVerified) VALUES (11117, 2, -1, 1, 0, -370, 0, 0, 0, 0, 1101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 32907, 1, 0, 0, 0, 0, 0, 0, 0, 32233, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'Catch the Wild Wolpertinger!', 'Goldark Snipehunter has asked you to capture 5 Stunned Wolpertingers using the Wolpertinger Net. He mentioned that you must be intoxicated or wearing Synthebrew Goggles to see them.', 'Here now. Ye hear that? There be sounds in them hills. Those\'re the wolpertingers! Wily beasts, they are, attracted by the smells o\' Brewfest. I\'ve a mind to catch me some, but I knocked me shin and can\'t outrun the buggers. Ye can help me, though!$b$bTake this net and cast it over the little blighters. Bring me a good five of \'em and I\'ll make it worth yer while! One more thing - ye gotta see through the eyes of a drunk to spot \'em! Load up on the booze or ask me fer some Synthebrew Goggles!', '', 'Well, lookee there! Ye\'ve got yerself a right bushel o\' wolpertingers, ye do!$b$b<He takes a deep drink from his tankard.>$b$bI\'ll tell ye what I\'m gonna do. Since ye\'re such a spot-on $c, I\'ll let ye keep one\'a these fer yer very own!', 'Were ya drunk enough to see the little buggers?', 'Return to Goldark Snipehunter in Dun Morogh.', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 32906, 32907, 0, 0, 0, 0, 5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', '', '', '', 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12340);
UPDATE creature_template SET unit_flags = 0 WHERE entry = 23487;

-- Fix Berserk ability effects (61714, 61715) in Malygos encounter in instance Eye of Eternity, may only target Malygos (28859)
DELETE FROM `conditions` WHERE `SourceEntry` IN (61714, 61715) AND `SourceTypeOrReferenceId` = 13;
INSERT INTO `conditions` (SourceTypeOrReferenceId, SourceGroup, SourceEntry, SourceId, ElseGroup, ConditionTypeOrReference, ConditionTarget, ConditionValue1, ConditionValue2, ConditionValue3, NegativeCondition, ErrorTextId, ScriptName, Comment) VALUES
(13, 7, 61714, 0, 0, 31, 0, 3, 28859, 0, 0, 0, '', 'Berserk effect may only target Malygos'),
(13, 7, 61715, 0, 0, 31, 0, 3, 28859, 0, 0, 0, '', 'Berserk effect may only target Malygos');

-- Fix quest The Denouncement / Die Verleumdung 12273, item should only target relevant NPCS, taken from TC original database
DELETE FROM `conditions` WHERE `SourceTypeOrReferenceId` = 17 AND `SourceEntry` = 48712;
INSERT INTO `conditions` (SourceTypeOrReferenceId, SourceGroup, SourceEntry, SourceId, ElseGroup, ConditionTypeOrReference, ConditionTarget, ConditionValue1, ConditionValue2, ConditionValue3, NegativeCondition, ErrorTextId, ScriptName, Comment) VALUES
(17, 0, 48712, 0, 0, 31, 1, 3, 27234, 0, 0, 0, '', 'The Denouncement: Rod - Goodman target'),
(17, 0, 48712, 0, 1, 31, 1, 3, 27235, 0, 0, 0, '', 'The Denouncement: Rod - Zierhut target'),
(17, 0, 48712, 0, 2, 31, 1, 3, 27236, 0, 0, 0, '', 'The Denouncement: Rod - Mercer target'),
(17, 0, 48712, 0, 3, 31, 1, 3, 27237, 0, 0, 0, '', 'The Denouncement: Rod - Jordan target');

-- HACK-Fix mage ability Invisibility / Unsichtbarkeit (spells 66, 35009, 32612) causing
-- mage to enter combat for a short moment with every hostile NPC nearby
-- Add SPELL_ATTR3_NO_INITIAL_AGGRO to the spell
UPDATE `spell_dbc` SET `AttributesEx3` = `AttributesEx3` | 131072 WHERE `id` = 35009;